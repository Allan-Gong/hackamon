<!doctype html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>My marks - Monash University</title>

    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <!-- Place favicon.ico in the root directory -->

    <!-- Material Design fonts -->
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Roboto:300,400,500,700">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/icon?family=Material+Icons">


    <!-- Monash brand -->
    <link rel="stylesheet" type="text/css" href="styles/monash-minimal.css">
    

    <link rel="stylesheet" href="styles/main.css">

    <script src="scripts/vendor/modernizr.js"></script>
</head>

<body>

  <!--[if IE]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
<![endif]-->
  <header>
    <div class="wrapper flex-container-row space-between">
        <div class="monash-brandheader npt"><a href="http://monash.edu/" alt="Monash University"><span class="hidden">Monash University</span></a></div>
        <h1 class="brand-label large-txt">my.marks</h1>
    </div>
</header>
  <div class="container">



    <section id="cd-timeline" class="cd-container">
      <div class="cd-timeline-block assignment">
  <div class="cd-timeline-img pass"></div>
  <!-- cd-timeline-img -->

  <div class="cd-timeline-content panel-primary">
    <h2 class="panel-heading med-txt flex-container-row space-between"><span>Assignment 1 Developing an Excel application </span> <span class="np">(5%)</span></h2>
    <div class="panel-content flex-container-row space-between plr">
      <p>Feedback: Great work. Expanding into lookup tables would have earned the extra marks</p>
      <div class="flex-container-column">
        <a class="badge pass"><strong>Mark </strong><span class="score" data-p=0.05 data-id=1>67</span></a>
        <span class="cd-date">14/03/2017</span>

        <!--<p>Your score is higher than 60% of your classmates:</p>
        <div class="progress">
          <div class="progress-bar" style="width: 100%;">
            <div class="primary-color location-60"></div>
          </div>
        </div>-->

      </div>
    </div>

  </div>
  <!-- cd-timeline-content -->
</div>
<!-- cd-timeline-block -->
      <div class="cd-timeline-block assignment">
  <div class="cd-timeline-img at-risk"></div>
  <!-- cd-timeline-img -->

  <div class="cd-timeline-content panel-danger">
    <h2 class="panel-heading med-txt flex-container-row space-between"><span>Class Test</span> <span class="np">(7%)</span></h2>
    <div class="panel-content flex-container-row space-between plr">
      <div>
        <p>Feedback: We missed you!</p>
      </div>
      <div class="flex-container-column">

        <a class="badge at-risk"><strong>Mark </strong><span class="score" data-p=0.07 data-id=2>0</span></a>
        <span class="cd-date">28/03/2017</span>

    <!--<p>Your score is higher than 60% of your classmates:</p>
    <div class="progress">
      <div class="progress-bar" style="width: 100%;">
        <div class="primary-color location-60"></div>
      </div>
    </div>-->

      </div>
    </div>
  </div>
  <!-- cd-timeline-content -->
</div>
<!-- cd-timeline-block -->
      <div class="cd-timeline-block assignment right">
  <div class="cd-timeline-img due"></div>
  <!-- cd-timeline-img -->

  <div class="cd-timeline-content panel panel-warning">
    <h2 class="panel-heading med-txt flex-container-row space-between"><span>Tutorials and Quizzes</span><span class="np">(8%)</span></h2>
    <div class="flex-container-row space-between plr">
      <form>
          <div class="form-group flex-container-column plrh pth">
            <label for="input-score" class="control-label">Target score</label>
            <input type="text" class="form-control score" data-p=0.08 data-id=3 id="input-score" placeholder="score">
          </div>
      </form>

      <span class="cd-date flexbox-quarter">30/03/2017</span>
    </div>
  </div>
  <!-- cd-timeline-content -->
</div>
<!-- cd-timeline-block -->
      <div class="cd-timeline-block assignment right">
  <div class="cd-timeline-img not-due"></div>
  <!-- cd-timeline-img -->

  <div class="cd-timeline-content panel panel-default">
    <h2 class="panel-heading med-txt flex-container-row space-between"><span>Assignment 2 Querying a database; creating advanced queries</span><span class="np">(20%)</span></h2>
    <div class="flex-container-row space-between plr">
      <form>
          <div class="form-group flex-container-column plrh pth">
            <label for="input-score" class="control-label">Target score</label>
            <input type="text" class="form-control score" data-p=0.2 data-id=4 id="input-score">

          </div>
      </form>

      <span class="cd-date flexbox-quarter">14/05/2017</span>
    </div>
  </div>
  <!-- cd-timeline-content -->
</div>
<!-- cd-timeline-block -->
      <div class="cd-timeline-block assignment right">
  <div class="cd-timeline-img not-due"></div>
  <!-- cd-timeline-img -->

  <div class="cd-timeline-content panel panel-default">
    <h2 class="panel-heading med-txt flex-container-row space-between"><span>Exam</span><span class="np">(60%)</span></h2>
    <div class="flex-container-row space-between plr">
      <form>
          <div class="form-group flex-container-column plrh pth">
            <label for="input-score" class="control-label">Target score</label>
            <input type="text" class="form-control score" data-p=0.6 data-id=5 id="input-score" placeholder="score">
          </div>
      </form>
      <span class="cd-date flexbox-quarter">14/06/2017</span>
    </div>
  </div>
  <!-- cd-timeline-content -->
</div>
<!-- cd-timeline-block -->
    </section>

    <div class="footer">
    <p>â™¥ from the MAD COW team</p>
</div>

  </div>

  <section class="score-container">


    <div class="wrapper flex-container-row flex-end">
      <div class="popover-container graph-container">
        <div class="graph"  data-container="body" data-toggle="popover" data-placement="top" data-content="Your average score so far is higher than 56% of your classmates"></div>
      </div>
      <div class="flex-container-column">
        <p class=" pth nm">Set goal</p>
        <div class="btn-group pth">

          <a href="#" data-level="p" class="btn btn-feature">P</a>
          <a href="#" data-level="c" class="btn btn-feature">C</a>
          <a href="#" data-level="d" class="btn btn-feature">D</a>
          <a href="#" data-level="hd" class="btn btn-feature">HD</a>
        </div>
      </div>
      <div class="flex-container-column">
        <p class="pth nm">Estimate grade</p>
        <div class="large-txt">
          <span class="level">N/A</span> <span class="score">N/A</span>
        </div>
      </div>
  </section>

  <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
<script>
    (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
    function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
    e=o.createElement(i);r=o.getElementsByTagName(i)[0];
    e.src='https://www.google-analytics.com/analytics.js';
    r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
    ga('create','UA-XXXXX-X');ga('send','pageview');
</script>

<script src="scripts/vendor.js"></script>

<script src="scripts/plugins.js"></script>

<script src="scripts/main.js"></script>

  <script type="text/javascript">
    //<![CDATA[
    var initial_assignment_data = [];
    var assignment_data = [];

    var typingTimers = new Array();
    var doneTypingInterval = 500;
    var not_applicable = 'N/A';

    function calculate_score() {
      console.log(assignment_data);

      var can_calculate = _.find(assignment_data, function (a) {
        return parseInt(a.s) == NaN;
      }) == undefined ? true : false;

      if (!can_calculate) {
        return '-';
      }

      var final_score = _.reduce(assignment_data, function (sum, a) {
        return sum + (a.s * a.p)
      }, 0);

      return Math.round(final_score * 10) / 10;
    }

    function caldulate_level(score) {
      if (score == not_applicable) {
        return not_applicable;
      }

      if (score < 50) {
        return "N";
      }

      if (score >= 50 && score < 60) {
        return "P";
      }

      if (score >= 60 && score < 70) {
        return "C";
      }

      if (score >= 70 && score < 80) {
        return "D";
      }

      if (score >= 80) {
        return "HD";
      }
    }

    function init_data_from_ui() {
      $('.assignment .score').each(function (index, ele) {
        var id = $(ele).attr('data-id');
        var percentage = $(ele).attr('data-p');
        var score = $(ele).text() || $(ele).val();
        console.log(id, score);

        assignment_data.push({
          'id': id,
          's': parseInt(score),
          'p': percentage
        });

        initial_assignment_data.push({
          'id': id,
          's': parseInt(score),
          'p': percentage
        });
      });
    }

    function render_final_score() {
      var final_score = calculate_score();
      var final_level = caldulate_level(final_score);

      console.log(final_level, final_score);

      $('.score-container .level').text(final_level);
      $('.score-container .score').text(final_score);
    }

    function populate_pending_scores(level) {
      console.log('selected level: ', level);

      var minimum_score;
      var minimum_score_percentage;

      switch (level) {
        case "p":
          minimum_score = 50;
          minimum_score_percentage = 0.5;
          break;
        case "c":
          minimum_score = 60;
          minimum_score_percentage = 0.6;
          break;
        case "d":
          minimum_score = 70;
          minimum_score_percentage = 0.7;
          break;
        case "hd":
          minimum_score = 80;
          minimum_score_percentage = 0.8;
          break;
      }

      console.log('minimum_score: ', minimum_score);
      console.log('minimum_score_percentage: ', minimum_score_percentage);

      console.log('initial_assignment_data: ', initial_assignment_data);
      console.log('assignment_data: ', assignment_data);
      assignment_data = jQuery.extend(true, [], initial_assignment_data); //JSON.parse(JSON.stringify(initial_assignment_data));;

      var completed_assignments = _.filter(assignment_data, function (a) {
        return !isNaN(a.s);
      });
      console.log('completed_assignments: ', completed_assignments);

      var total_completed_percentage = _.reduce(completed_assignments, function (sum, a) {
        return sum + parseFloat(a.p);
      }, 0);
      console.log('total_completed_percentage: ', total_completed_percentage);

      var pending_assignments = _.filter(assignment_data, function (a) {
        return isNaN(a.s);
      });
      console.log('pending_assignments: ', pending_assignments);

      var total_pending_percentage = _.reduce(pending_assignments, function (sum, a) {
        return sum + parseFloat(a.p);
      }, 0);
      console.log('total_pending_percentage: ', total_pending_percentage);

      var completed_score = _.reduce(completed_assignments, function (sum, a) {
        return sum + (a.s * a.p)
      }, 0);
      completed_score = Math.floor(completed_score);
      console.log('completed_score: ', completed_score);

      var minimum_completed_score = _.reduce(completed_assignments, function (sum, a) {
        return sum + a.p * 100
      }, 0);
      minimum_completed_score = Math.ceil(minimum_completed_score * minimum_score_percentage);
      console.log('minimum_completed_score: ', minimum_completed_score);

      if (completed_score >= minimum_completed_score) { // minimum mark will do
        console.log('minimum mark will do');

        _.forEach(pending_assignments, function (a) {
          a.s = 100 * minimum_score_percentage;
          a.s = Math.ceil(a.s);
          console.log('a: ', a);
        });
      } else {
        console.log('minimum mark will NOT do');

        var difference = Math.ceil( minimum_completed_score - completed_score );
        difference = (minimum_score + difference) / total_pending_percentage - minimum_score;
        console.log('difference: ' + difference);

        // var minimum_expected_score = (minimum_score + difference) / minimum_score_percentage - minimum_score;

        _.forEach(pending_assignments, function (a) {
          var weighted_difference = Math.ceil(difference * (a.p / total_pending_percentage));
          console.log('weighted_difference: ', weighted_difference);

          var calculate_score = 100 * minimum_score_percentage + weighted_difference;
          console.log('calculated score: ', calculate_score);

          a.s = calculate_score;
          a.s = Math.ceil(a.s);
        });

      }

      _.forEach(pending_assignments, function (a) {
        console.log('pending_assignments rendering: ', a.s);
        $('.assignment .score[data-id=' + a.id + ']').val(a.s);
      });
    }

    function doneTyping(ele) {
      var id = $(ele).attr('data-id');
      var score = $(ele).val();

      var assignment = _.find(assignment_data, function (a) {
        return a.id == id;
      });

      assignment.s = parseInt(score);

      console.log('assignment:', assignment);

      render_final_score();
    }

    $(function () {
      init_data_from_ui();
      render_final_score();

      $('.assignment .score').each(function () {
        var ele = this;
        $(this).keyup(function () {
          var $this = $(this);

          clearTimeout($this.data('timer'));
          $this.data('timer', setTimeout(function () {
            $this.removeData('timer');

            doneTyping(ele);
          }, doneTypingInterval));
        });
      });

      $('.score-container .btn-group .btn').each(function () {
        $(this).click(function () {
          $('.score-container .btn-group .btn').removeClass('active');
          $(this).toggleClass('active');
          var level = $(this).attr('data-level');
          $('.form-group').removeClass('focused').addClass('focused');
          populate_pending_scores(level);
          render_final_score();
        });
      });

    });

    //]]>

  </script>

</body>
</html>
